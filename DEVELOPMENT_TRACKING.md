# 开发任务追踪文档

> 记录所有待开发、开发中、已完成的功能需求
> 最后更新：2026-02-23 15:05

---

## 🆕 最新完成

### 首页今日待办优化（已完成任务置灰保留显示）✅
**状态**：已完成  
**负责人**：fix-todo-complete-display  
**完成时间**：2026-02-23 15:05

**用户反馈问题**：
1. 首页今日待办列表中，点击圆圈完成任务后，任务从列表中消失
2. 用户希望完成的任务仍然保留在列表中，只是样式变为灰色/完成状态

**修复内容**：

| 修复项 | 状态 | 说明 |
|--------|------|------|
| API调用修改 | ✅ | 从 `taskApi.getTodayTasks` 改为 `taskApi.getList`，传入日期参数获取今日所有任务（包括已完成的） |
| 任务排序逻辑 | ✅ | 添加排序：未完成的任务排在前面，已完成的排在后面；同状态下按优先级排序 |
| 已完成样式增强 | ✅ | 已完成任务添加透明度(0.7)、灰色背景、淡化时间颜色、淡化优先级标签 |
| 标题样式优化 | ✅ | 已完成任务标题添加删除线、浅灰色(#a0aec0)、正常字重 |
| 数据刷新保留 | ✅ | 页面刷新后已完成的任务仍然显示在列表中 |

**修改文件**：
- `frontend/src/pages/home/index.vue`
  - 添加 `getTodayString()` 辅助函数获取今日日期
  - 修改 `loadHomeData()`：使用 `taskApi.getList(familyId, { dueDate: todayStr })` 获取今日所有任务
  - 添加任务排序逻辑：按状态(未完成在前)和优先级排序
  - 增强 `.task-item.completed` 样式：添加透明度、背景色、淡化各元素
  - 增强 `.task-title.completed` 样式：删除线、灰色、正常字重

**技术实现**：
```javascript
// 获取今日所有任务（包括已完成的）
const todayStr = getTodayString()
tasksRes = await taskApi.getList(familyId, { dueDate: todayStr })

// 排序：未完成在前，已完成在后
todayTasks.value = tasks.map(...).sort((a, b) => {
  if (a.status === b.status) {
    return b.priority - a.priority
  }
  return a.status - b.status
})
```

**视觉效果**：
- 未完成任务：正常显示，黑色标题，彩色优先级标签
- 已完成任务：整体透明度70%，灰色背景，标题删除线+灰色，优先级标签淡化

---

### 首页健康概览区域样式统一修复 ✅
**状态**：已完成  
**负责人**：fix-home-health-style  
**完成时间**：2026-02-23

**用户反馈问题**：
1. "今日饮水"区域有独立的进度条样式（绿色进度条 + 百分比248%），与上方三个图标统计风格不一致
2. "今日摄入进度"也有独立的进度条，样式不统一
3. 健康概览区域整体视觉不协调

**修复内容**：
| 修复项 | 状态 | 说明 |
|--------|------|------|
| 统计卡片重构 | ✅ | 三个统计项改为横向排列，图标+数值+标签结构统一 |
| 移除独立饮水进度 | ✅ | 删除单独的"今日饮水"进度条区域，整合到统一进度区 |
| 统一进度条区域 | ✅ | 新增health-progress-section，包含热量和饮水两个进度项 |
| 进度条样式统一 | ✅ | 相同高度(12rpx)、圆角、shine动画效果 |
| 颜色协调 | ✅ | 热量使用薄荷绿(#A8E6CF)，饮水使用紫色(#667eea)，完成状态统一使用绿色(#48bb78) |
| 布局优化 | ✅ | 统计区添加浅灰背景，进度区添加边框，层次分明 |
| 交互统一 | ✅ | 点击统计项或进度项可跳转到对应页面或设置目标 |

**修改文件**：
- `frontend/src/pages/home/index.vue`
  - 重构 health-stats 区域：改为flex横向布局，添加stat-info包裹数值和标签
  - 新增 health-progress-section：统一展示热量摄入和饮水进度
  - 更新样式：统一颜色、字体、间距，确保视觉协调
  - 移除旧的water-progress-section和calorie-progress相关代码

**设计亮点**：
- 统计卡片采用图标+文字横向布局，更紧凑美观
- 进度条区域统一展示，信息清晰易读
- 配色协调：热量(绿)、饮水(紫)、完成(绿)
- 响应式设计，适配不同屏幕

---

### 喝水记录删除功能修复 ✅
**状态**：已完成  
**负责人**：fix-water-delete-icon-fail  
**完成时间**：2026-02-23 15:00

**用户反馈问题**：
1. 删除图标不明显 - 用户不知道红色圆形图标是删除功能
2. 删除失败 - 点击删除后提示"删除失败"错误

**修复内容**：

#### 1. 前端修复（删除按钮优化）✅
| 修复项 | 状态 | 说明 |
|--------|------|------|
| ✅ 图标+文字 | ✅ | 删除按钮从纯图标改为图标+"删除"文字组合 |
| ✅ 按钮尺寸 | ✅ | 宽度从64rpx增加到100rpx，更明显易点击 |
| ✅ Hover效果 | ✅ | 添加hover上移效果，提升交互反馈 |
| ✅ 点击效果 | ✅ | 添加active缩放效果，点击有明显反馈 |
| ✅ 阴影增强 | ✅ | 阴影从12rpx增强到16rpx，更醒目 |
| ✅ 历史记录 | ✅ | 历史记录弹窗中的删除按钮也添加hover效果 |

#### 2. 后端修复（删除接口增强）✅
| 修复项 | 状态 | 说明 |
|--------|------|------|
| ✅ 参数校验 | ✅ | 添加ID有效性校验（null或<=0返回400错误） |
| ✅ 登录验证 | ✅ | 完善登录验证，未登录返回401错误 |
| ✅ 详细日志 | ✅ | 添加全流程日志：请求开始、用户ID、记录查询、权限校验、删除结果 |
| ✅ 异常处理 | ✅ | 添加try-catch块捕获删除异常，返回500错误 |
| ✅ 错误信息 | ✅ | 返回具体错误原因（记录不存在/无权删除/服务器错误） |

#### 3. 错误处理优化 ✅
| 修复项 | 状态 | 说明 |
|--------|------|------|
| ✅ 加载状态 | ✅ | 删除时显示"删除中..."loading提示 |
| ✅ 详细错误 | ✅ | 根据状态码显示具体错误：401未登录/403无权/404不存在/500服务器错误 |
| ✅ 成功刷新 | ✅ | 删除成功后同时刷新今日记录和历史记录 |
| ✅ 调试日志 | ✅ | 前端添加console.log输出删除过程，便于排查问题 |

**修改文件**：
- `frontend/src/pages/water/index.vue`
  - 删除按钮模板：添加`delete-text`文字和`title`属性
  - 删除按钮样式：宽度100rpx，添加hover/active效果
  - `deleteRecord()`函数：添加loading状态、详细错误处理、await刷新
  - `deleteHistoryRecord()`函数：添加loading状态、详细错误处理、双重刷新

- `backend/family-service/health-service/src/main/java/com/family/health/controller/WaterController.java`
  - `deleteRecord()`方法：添加参数校验、详细日志、异常处理

**API接口信息**：
- 接口地址：`DELETE /api/health/water/{id}`
- 响应码：
  - 200: 删除成功
  - 400: 无效的记录ID
  - 401: 未登录
  - 403: 无权删除此记录
  - 404: 记录不存在
  - 500: 服务器内部错误

---

### 任务清单页面布局修复 ✅
**状态**：已完成  
**负责人**：fix-task-list-layout  
**完成时间**：2026-02-23 14:45

**问题描述**：
用户反馈任务清单页面布局存在以下问题：
1. 页面排版不够规整
2. 任务列表项右侧被截断，显示不全
3. 列表区域高度不够，没有占满屏幕剩余空间

**修复内容**：
| 修复项 | 状态 | 说明 |
|--------|------|------|
| ✅ Flex布局 | ✅ | 将page-container改为flex布局，使列表区占满剩余空间 |
| ✅ 列表高度 | ✅ | 将task-list从固定高度calc改为flex:1自适应 |
| ✅ 宽度自适应 | ✅ | task-card添加width:100%和box-sizing:border-box |
| ✅ 文字截断修复 | ✅ | task-title-wrap添加min-width:0和overflow:hidden，task-title添加word-wrap:break-word |
| ✅ 滚动优化 | ✅ | task-list添加overflow-y:auto确保可滚动 |

**修改文件**：
- `frontend/src/pages/task/index.vue`
  - `.page-container`: 添加 `display: flex; flex-direction: column; box-sizing: border-box;`
  - `.task-list`: 改为 `flex: 1; min-height: 0; overflow-y: auto;`，移除固定高度
  - `.task-card`: 添加 `width: 100%; box-sizing: border-box;`
  - `.task-title-wrap`: 添加 `min-width: 0; overflow: hidden;`
  - `.task-title`: 添加 `word-wrap: break-word; overflow-wrap: break-word;`

---

### 任务清单页面优化（浅蓝色风格 + 功能完善）✅
**状态**：已完成  
**负责人**：task-list-enhance  
**完成时间**：2026-02-23 14:30

**需求描述**：
对任务清单页面进行样式改版和功能完善。

**完成内容**：
| 功能 | 状态 | 说明 |
|------|------|------|
| ✅ 添加待办弹窗统一 | ✅ | 右下角"+"按钮点击后，改为和首页一样的TodoCreateModal弹窗创建页面 |
| ✅ 页面样式改版 | ✅ | 改为浅蓝色风格（主色#5B8FF9），整体页面更规整，优化布局和视觉层次 |
| ✅ 列表排序 | ✅ | 任务列表按截止日期排序，由近及远（最近的在前面） |
| ✅ 筛选功能 | ✅ | "待完成"和"已完成"按钮可点击筛选，支持全部/待完成/已完成三种状态切换 |
| ✅ 日历视图入口 | ✅ | 保留原功能，浅蓝色卡片样式 |
| ✅ 任务列表展示 | ✅ | 白色圆角卡片，左侧优先级指示条，支持子任务进度显示 |
| ✅ 任务完成状态切换 | ✅ | 保留圆形复选框，点击切换完成状态 |

**配色方案**（浅蓝色风格）：
| 元素 | 颜色 | 说明 |
|------|------|------|
| 主色调 | #5B8FF9 | 天蓝色 |
| 主色浅色 | #E8F4FF | 浅蓝色背景 |
| 主色深色 | #2B6CB0 | 深蓝色文字 |
| 背景色 | #F0F7FF | 页面背景 |
| 成功色 | #48BB78 | 完成状态绿色 |
| 警告色 | #F6AD55 | 重要优先级 |
| 危险色 | #FC8181 | 紧急优先级 |

**修改文件**：
- `frontend/src/pages/task/index.vue` - 完全重写
  - 引入TodoCreateModal组件，统一弹窗创建体验
  - 全新浅蓝色风格设计
  - 添加任务按日期排序功能
  - 添加筛选标签和统计栏点击筛选
  - 优化任务卡片样式和布局
  - 简化子任务进度显示

**技术实现**：
- 使用computed属性`sortedTasks`实现按日期排序
- 使用computed属性`filteredTasks`实现状态筛选
- 引入`@/components/task/TodoCreateModal.vue`统一弹窗组件

---

### 任务清单页面重新设计（小清新风格）✅
**状态**：已完成  
**负责人**：task-list-redesign  
**完成时间**：2026-02-23 14:23

**需求描述**：
重新设计任务清单页面，去掉指定内容，使用小清新风格。

**去掉的内容**：
| 内容 | 说明 |
|------|------|
| ❌ 分类筛选标签 | 全部、购物、家务、排班等顶部筛选标签 |
| ❌ 排班表入口 | 视图切换入口中的排班表卡片 |
| ❌ 任务指派信息 | 任务列表项中的指派人图标和文字 |

**重新设计内容**：
| 功能 | 状态 | 说明 |
|------|------|------|
| ✅ 头部区域 | ✅ | 薄荷绿渐变背景，添加🌿图标，清新简洁 |
| ✅ 日历视图入口 | ✅ | 天蓝色调卡片，简洁的📅图标+文字布局 |
| ✅ 任务统计 | ✅ | 简约统计栏：待完成/已完成数量 |
| ✅ 任务列表 | ✅ | 白色圆角卡片，左侧优先级指示条 |
| ✅ 任务标题 | ✅ | 保留并优化显示 |
| ✅ 截止时间 | ✅ | 格式化显示（X月X日 XX:XX）|
| ✅ 优先级标签 | ✅ | 彩色标签（薄荷绿/黄色/粉色）|
| ✅ 完成状态圆圈 | ✅ | 圆形复选框，选中显示✓标记 |
| ✅ 子任务进度 | ✅ | 进度条+数字显示 |
| ✅ 空状态 | ✅ | 温馨空状态：🌸图标+友好提示 |
| ✅ 悬浮添加按钮 | ✅ | 右下角绿色渐变圆形FAB按钮 |

**配色方案**（小清新风格）：
| 元素 | 颜色 | 说明 |
|------|------|------|
| 主色调 | #7DD3C0 | 薄荷绿 |
| 辅助色1 | #87CEEB | 天蓝色（日历卡片）|
| 辅助色2 | #F4A6B5 | 淡粉色（点缀）|
| 背景色 | #F7FAFC | 浅灰白 |
| 文字主色 | #4A5568 | 深灰 |
| 文字浅色 | #A0AEC0 | 浅灰 |

**修改文件**：
- `frontend/src/pages/task/index.vue` - 完全重写
  - 删除分类标签栏
  - 删除排班表入口
  - 删除任务指派信息
  - 全新小清新风格设计
  - 添加任务统计栏
  - 优化任务卡片布局
  - 添加悬浮添加按钮
  - 统一弹窗样式

**设计亮点**：
- 圆角卡片设计，柔和阴影
- 优先级指示条（左侧彩色竖条）
- 简约统计信息（待完成/已完成）
- 任务卡片点击动效
- 整体配色清新柔和

---

### 数据看板页面实时查询开发（前后端）✅
**状态**：已完成  
**负责人**：dashboard-realtime-dev  
**完成时间**：2026-02-23 15:00

**需求描述**：
数据看板页面需要实时查询功能，前后端都要开发，从各服务获取实时数据。

**开发内容**：

#### 1. 前端开发 ✅
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 页面布局 | ✅ | `pages/dashboard/index.vue` 已优化 |
| 数据获取 | ✅ | 添加 familyId 获取逻辑，从 storage 读取 |
| API调用 | ✅ | 调用 statsApi 获取实时数据 |
| 数据展示 | ✅ | 今日概览、热量趋势、任务统计、月度概览 |
| 加载状态 | ✅ | 添加 isLoading 状态管理 |
| 错误处理 | ✅ | 添加 try-catch 和错误提示 |

**前端修改文件**：
- `frontend/src/pages/dashboard/index.vue` - 数据看板页面
  - 添加 familyId 初始化逻辑
  - 优化 loadData 函数，支持 familyId 传递
  - 添加加载状态和错误处理
- `frontend/src/api/stats.js` - 统计API
  - 更新 API 方法签名，支持 familyId 参数

#### 2. 后端开发 ✅
| 检查项 | 状态 | 说明 |
|--------|------|------|
| StatsServiceImpl | ✅ | 实现所有统计方法 |
| 今日概览 | ✅ | getTodayOverview - 实时查询今日数据 |
| 本周热量趋势 | ✅ | getDietStats - 查询本周每日热量 |
| 任务统计 | ✅ | getTaskStats - 查询任务完成情况 |
| 月度统计 | ✅ | getPersonalStats - 查询月度饮食数据 |
| 年度徽章 | ✅ | getYearlyStats - 返回年度成就数据 |

**后端修改文件**：
- `backend/family-service/family-service/src/main/java/com/family/family/service/impl/StatsServiceImpl.java`
  - 实现 getTodayOverview: 查询今日待办、热量、本周完成、家庭成员
  - 实现 getDietStats: 查询本周每天的热量摄入和平均值
  - 实现 getTaskStats: 查询任务状态分布和完成率
  - 实现 getPersonalStats: 查询月度饮食统计
  - 实现 getYearlyStats: 返回年度徽章数据

#### 3. 数据源集成 ✅
| 数据源 | 服务 | 说明 |
|--------|------|------|
| 任务数据 | task-service | TaskMapper 查询今日任务、本周完成、状态分布 |
| 饮食数据 | health-service | DietRecordMapper 查询热量统计 |
| 家庭成员 | family-service | FamilyMemberMapper 查询成员数量 |

**实现详情**：

**今日概览数据**：
```java
- todayTasks: 今日待办任务数（未完成的今日任务）
- todayCalories: 今日热量摄入（sum calories from diet_record）
- weeklyCompletedTasks: 本周完成任务数（周一到今天）
- memberCount: 家庭成员数量
```

**本周热量趋势**：
```java
- calorieTrend: 周一至今天的每日热量数组
- avgCalories: 本周平均热量
- daysWithData: 有记录的天数
```

**任务统计**：
```java
- totalTasks: 总任务数
- completedTasks: 已完成数
- pendingTasks: 待办数
- inProgressTasks: 进行中数
- cancelledTasks: 已取消数
- completionRate: 完成率百分比
- statusDistribution: 状态分布 {0:待办, 1:进行中, 2:已完成, 3:已取消}
```

---

## ✅ 已完成

### 喝水记录删除按钮功能 ✅
**状态**：已完成  
**负责人**：water-delete-btn  
**完成时间**：2026-02-23 14:21

**需求描述**：
在喝水打卡页面的"今日记录"列表中，每条记录右侧增加删除按钮，并且要有实际的删除功能。

**完成内容**：
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 删除按钮UI | ✅ | 每条记录右侧添加垃圾桶图标（up-icon name="trash"） |
| 确认弹窗 | ✅ | 点击删除弹出uni.showModal确认对话框 |
| API调用 | ✅ | 调用waterApi.deleteRecord(recordId)删除记录 |
| 刷新列表 | ✅ | 删除成功后调用loadTodayData()刷新今日记录 |
| 更新统计 | ✅ | 自动更新今日饮水总量显示 |
| 历史记录删除 | ✅ | 历史记录弹窗中的记录也支持删除 |

**修改文件**：
- `src/pages/water/index.vue` - 删除按钮已存在，功能完整

**实现代码位置**：
- 模板：`<view class="record-delete" @click="deleteRecord(record.id)">`
- 方法：`deleteRecord()` 函数（line 324-347）
- API：`waterApi.deleteRecord(id)` in `src/api/water.js`

---

### 首页快捷图标优化 ✅
**状态**：已完成  
**负责人**：home-icon-remove  
**完成时间**：2026-02-23 14:19  

**需求描述**：
1. 去掉首页6个快捷图标中的"添加任务"图标
2. 去掉首页6个快捷图标中的"优惠券"图标  
3. 修改"今日待办"区域右侧的"+ 添加任务"按钮文字为"+ 添加待办"

**执行内容**：
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 删除"添加任务"图标 | ✅ | 从quickActions数组中移除 |
| 删除"优惠券"图标 | ✅ | 从quickActions数组中移除 |
| 修改按钮文字 | ✅ | "+ 添加任务" → "+ 添加待办" |
| 保留4个图标 | ✅ | 记录饮食、喝水打卡、营养成分、AI助手 |

**修改文件**：
- `src/pages/home/index.vue` - 修改quickActions数组和按钮文字

**修改后快捷图标列表**：
- 记录饮食
- 喝水打卡  
- 营养成分
- AI助手

---

### 隐藏财务报表功能 ✅
**状态**：已完成  
**负责人**：hide-financial-report  
**完成时间**：2026-02-23 14:10  

**需求描述**：
1. 隐藏财务报表功能的入口
2. 保留财务报表页面代码但不展示入口

**执行内容**：
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 首页数据看板入口 | ✅ 已隐藏 | 高级报表区域的财务报表卡片已注释隐藏 |
| "我的"页面入口 | ✅ 无需处理 | 无直接财务报表入口 |
| 页面文件保留 | ✅ 保留 | pages/dashboard/finance.vue 页面文件保留，可恢复 |
| pages.json配置 | ✅ 保留 | 页面路由配置保留，不影响功能恢复 |

**修改文件**：
- `src/pages/dashboard/index.vue` - 注释隐藏财务报表入口卡片（保留代码，可恢复）

**处理方式**：
- 采用注释方式隐藏入口，不删除页面文件
- 财务报表页面仍可访问（直接输入URL），但无入口引导
- 如需完全恢复功能，只需取消注释即可

---

### 任务详情页面重新开发 ✅
**状态**：已完成  
**负责人**：task-detail-redesign  
**完成时间**：2026-02-23 14:10  

**需求描述**：
1. 重新开发任务详情页面（pages/task/detail.vue）
2. 样式布局美观
3. 去掉执行人区域和子任务区域
4. 保留任务标题、截止时间、优先级、提醒设置、标记完成、删除任务功能

**完成内容**：
| 功能 | 状态 | 说明 |
|------|------|------|
| 任务标题展示 | ✅ | 顶部渐变色卡片，含复选框和状态标签 |
| 截止时间 | ✅ | 信息卡片展示，支持编辑入口 |
| 优先级 | ✅ | 彩色标签展示，区分普通/重要/紧急 |
| 任务分类 | ✅ | 显示分类信息 |
| 备注功能 | ✅ | 单独卡片展示，支持添加备注入口 |
| 提醒设置 | ✅ | 卡片式展示已设置提醒，支持添加/删除 |
| 标记完成 | ✅ | 底部操作栏，绿色渐变按钮 |
| 删除任务 | ✅ | 底部操作栏，红色边框按钮 |
| 重新打开 | ✅ | 任务完成后显示重新打开按钮 |
| 样式优化 | ✅ | 全新UI设计，渐变色彩，圆角卡片 |

**修改文件**：
- `src/pages/task/detail.vue` - 完全重写页面

**设计亮点**：
- 顶部渐变色标题卡片，视觉效果突出
- 信息卡片采用图标+文字布局，清晰易读
- 底部固定操作栏，操作便捷
- 提醒设置弹窗支持时间和位置两种提醒类型
- 整体采用圆角卡片设计，现代化风格

---

### TabBar 点击切换问题修复 ✅
**状态**：已修复  
**负责人**：fix-tabbar-switch  
**完成时间**：2026-02-23 14:00  

**问题描述**：
底部任务栏（tabBar）已正常显示，但点击切换页面时，全部提示"网络问题不显示"。

**排查过程**：
1. ✅ 检查 pages.json - 配置正确
2. ✅ 检查页面文件 - 所有文件都存在
3. ✅ 检查页面代码 - 无语法错误
4. ✅ 检查后端 API - 服务正常运行
5. ✅ 检查 vite 配置 - 代理配置正确
6. ⚠️ 发现问题 - preloadRule 配置可能干扰 tabBar 切换

**修复内容**：
- 移除了 `pages.json` 中的 `preloadRule` 配置

**修改文件**：
- `src/pages.json` - 删除 preloadRule 配置块

**验证步骤**：
1. 重新启动开发服务器（端口 3001）
2. 访问 http://localhost:3001/ 测试 tabBar 切换
3. 检查浏览器控制台是否有错误

**测试链接**：
- 首页：http://localhost:3001/
- 任务：http://localhost:3001/#/pages/task/index
- 心愿：http://localhost:3001/#/pages/wish/index
- 家庭：http://localhost:3001/#/pages/family/index
- 我的：http://localhost:3001/#/pages/profile/index

---

### 首页待办事项创建改为弹出式窗口 ✅
**状态**：已完成  
**负责人**：home-todo-popup  
**完成时间**：2026-02-23  

**需求描述**：
1. 首页"今日待办"区域的创建任务改为弹出式窗口（弹窗）
2. 日期虽然可选择，但默认今天

**实现内容**：
| 功能 | 状态 | 说明 |
|------|------|------|
| 弹出式创建窗口 | ✅ | 点击"+ 添加任务"按钮打开弹窗，不再跳转页面 |
| 任务标题输入 | ✅ | 支持最多50个字符，必填验证 |
| 日期选择 | ✅ | 默认今天，可点击选择其他日期 |
| 优先级选择 | ✅ | 普通/重要/紧急三档，默认普通 |
| 确认/取消按钮 | ✅ | 渐变绿色确认按钮，灰色取消按钮 |
| 创建后刷新 | ✅ | 创建成功后自动刷新今日待办列表 |
| 样式美观 | ✅ | 与App整体风格一致，渐变绿色主题 |

**修改文件**：
- `src/components/task/TodoCreateModal.vue` - 新建弹窗组件
- `src/pages/home/index.vue` - 引入弹窗组件，修改添加任务逻辑

**技术实现**：
- 使用uni-app picker组件实现日期选择
- 默认日期通过getTodayString()动态获取
- 调用taskApi.create API创建任务
- 创建成功后调用loadHomeData()刷新列表
- 弹窗动画使用fadeIn和slideUp效果
- 样式使用与App一致的渐变绿色主题

---

### 0. TabBar 不显示问题修复 ✅
**状态**：已完成（最高优先级）  
**负责人**：fix-tabbar-urgent  
**完成时间**：2026-02-23 13:37  

**问题描述**：
首页底部任务栏（tabBar）始终没有展示，用户多次反馈且之前多次尝试修复未成功。

**根本原因**：
1. `pages.json` 中设置了 `"custom": true`，导致 UniApp 不渲染原生 tabBar
2. App.vue 中使用 `up-tabbar` 组件实现自定义 tabBar，但 `showTabBar` 计算逻辑在初始加载时可能为 false

**修复方案**：
1. 将 `pages.json` 中的 `"custom": true` 改为 `"custom": false`
2. 简化 `App.vue`，移除自定义 tabBar 代码，使用原生 tabBar

**修改文件**：
- `src/pages.json` - `custom: true` → `custom: false`
- `src/App.vue` - 移除 `up-tabbar` 组件和相关逻辑

**验证步骤**：
1. 清除浏览器缓存
2. 重新编译：`npm run dev:h5`
3. 访问首页，检查底部是否显示5个 tab（首页、任务、心愿、家庭、我的）

---

### 1. 记录饮食页面重新开发 ✅
**状态**：已完成  
**负责人**：diet-record-redev  
**完成时间**：2026-02-23  

**完成功能**：
| 功能 | 状态 | 说明 |
|------|------|------|
| AI拍照识别 | ✅ | 拍照上传，AI识别食物种类和卡路里，支持修正识别结果 |
| 手动录入 | ✅ | 餐次选择、食物名称输入（带搜索）、重量输入、AI计算卡路里 |
| 保存功能 | ✅ | 保存饮食记录，支持"保存并继续添加" |
| 每日目标设置 | ✅ | 可设置每日卡路里目标，本地存储 |

**页面路径**：`pages/food/record.vue`

**技术实现**：
- 使用 `uni.chooseImage` 实现图片选择
- 预留 `dietApi.recognizeFood` AI识别接口
- 本地食物数据库 + AI卡路里计算
- 识别结果可手动修正（弹窗编辑）
- 目标设置保存到 `localStorage`

---

## 📌 开发中

### 2. 首页 AI购物助手图标入口 ⏳
**状态**：开发中  
**负责人**：diet-record-redev  
**开始时间**：2026-02-23  
**预计完成**：30分钟  

**需求描述**：
首页现有6个快捷功能图标，"AI助手"图标需点击跳转到AI购物助手功能页

**完成进度**：
- ✅ 移除之前错误添加的首页AI输入区域
- ⏳ 确认"AI助手"图标链接（当前已指向 pages/ai-shopping/index.vue）

---

### 3. AI购物助手功能页 🟡 中优先级
**状态**：待开发  
**负责人**：待定  
**预计工期**：2-3天  

**需求描述**：
完整的AI购物助手功能页，包含：
- AI对话式购物清单生成
- 清单详情（勾选、编辑、分享）
- 家庭库存管理
- 消费统计

**备注**：页面已存在 pages/ai-shopping/index.vue，需进一步完善功能

---

## 🔴 最高优先级排查任务

### tabBar 不显示问题排查 🔥
**状态**：正在排查  
**负责人**：fix-diet-bugs（手头工作完成后立即进行）  
**用户要求**：先完成手头工作，然后按清单逐项排查

**排查清单**：
- [ ] 第1项：检查 pages.json 配置（tabBar是否存在、路径是否正确）
- [ ] 第2项：检查页面注册（tabBar的5个页面是否都在pages数组中）
- [ ] 第3项：检查图标文件（static/tabbar/目录下是否有图标）
- [ ] 第4项：检查运行状态（前端是否重新编译、缓存是否清除）
- [ ] 第5项：检查代码冲突（是否有hideTabBar调用、样式遮挡）
- [ ] 第6项：测试验证（tabBar是否正常显示、点击切换是否正常）

**备注**：用户强调底部任务栏以前有，现在没有，要求彻底排查解决

---

## ✅ 已完成

| 功能 | 完成时间 | 备注 |
|------|----------|------|
| 登录跳转修复 | 2026-02-23 | 登录成功后跳转到首页 |
| 首页报错修复 | 2026-02-23 | 模板标签嵌套问题 |
| 首页样式修复 | 2026-02-23 | SCSS花括号不匹配 |
| tabBar添加 | 2026-02-23 | 底部导航栏配置 |
| 今日待办刷新 | 2026-02-23 | 添加onShow钩子 |
| 喝水记录修复 | 2026-02-23 | 端口和API修复 |

---

## 🐛 待修复问题（记录饮食页面 - 2026-02-23 用户反馈）

| 问题 | 状态 | 优先级 | 备注 |
|------|------|--------|------|
| 保存按钮无效 | ✅ 已修复 | 最高 | 添加登录检查、错误处理和成功提示 |
| 继续添加按钮无效 | ✅ 已修复 | 最高 | 修正弹窗添加继续添加功能，新增食物项 |
| AI计算未调用接口 | ✅ 已修复 | 最高 | 添加calculateCalories API调用，本地计算作为fallback |
| 拍照支持多张 | ✅ 已优化 | 中 | 支持最多9张照片，网格展示，可继续添加 |
| 手动录入UI不明显 | ✅ 已优化 | 中 | "多少克？"加粗，添加"输入重量(g)"提示，输入框高亮 |
| 当天饮食展示 | ✅ 已添加 | 中 | 底部新增今日已记录区域，显示缩略图+名称+卡路里 |
| 页面不自适应 | ✅ 已优化 | 低 | 使用rpx单位，响应式布局 |
| **tabBar不显示** | **✅ 已修复** | **中** | **图标位置错误，已复制到正确位置，现在正常显示** |
| 饮食记录实时查询 | 待确认 | 低 | 需确认是否修复 |
| **喝水图标修改** | **🔴 待处理** | **中** | **用户要求更换喝水页面顶部图标** |
| **喝水服务器错误** | **🔴 待排查** | **最高** | **提示"服务器内部错误"，需检查后端日志** |

---

## 🟡 待开发任务队列

### 4. 营养成分查询页面改版 🟡 中优先级
**状态**：待开发  
**负责人**：fix-diet-bugs（完成tabBar排查后进行）  
**预计工期**：1-2天  

**需求描述**：
重新设计营养成分查询页面，支持AI语音录入和分类选择。

**功能清单**：
| 功能 | 说明 | 优先级 |
|------|------|--------|
| 🎤 AI语音录入 | 语音输入食材名称，AI识别查询 | ⭐⭐⭐ |
| 📋 分类选择 | 蔬菜/水果/肉类/海鲜/谷物/坚果等分类 | ⭐⭐⭐ |
| 🥗 食材详情 | 显示每100克卡路里、蛋白质、脂肪、碳水 | ⭐⭐⭐ |
| 🎨 布局改版 | 重新设计页面样式，卡片式展示 | ⭐⭐ |

**页面结构**：
```
营养成分查询
├── 顶部搜索区（🔍搜索框 + 🎤语音按钮）
├── 分类导航（全部|蔬菜|水果|肉类...）
├── 食材列表（卡片网格布局）
│   └── [图片] 食材名称 + 100g/XX卡路里
└── 食材详情弹窗（营养数据展示）
```

**技术要点**：
- 页面路径：`pages/nutrition/index.vue`
- 本地食材数据库（先mock数据）
- 语音输入：`uni.getRecorderManager`
- 预留AI查询API接口

**备注**：布局样式要清新简洁，与App整体风格一致

---

### 5. 记录喝水页面增强 🟡 中优先级
**状态**：开发中  
**负责人**：water-enhance  
**预计工期**：半天  

**用户反馈需求**：

| 功能 | 状态 | 说明 | 优先级 |
|------|------|------|--------|
| ✅ 删除记录按钮 | 已完成 | 今日记录列表每项添加删除功能 | ⭐⭐⭐ |
| 📅 历史记录入口 | 待开发 | 添加历史记录页面，支持按日期查看 | ⭐⭐⭐ |
| 🐛 时间显示Bug | 待修复 | 修复NaN:NaN时间显示问题 | ⭐⭐ |

**详细需求**：

1. **删除功能**（✅ 已完成）：
   - ✅ 在今日记录列表每项右侧添加删除按钮（垃圾桶图标）
   - ✅ 删除前确认弹窗（uni.showModal）
   - ✅ 调用后端API删除记录（waterApi.deleteRecord）
   - ✅ 删除后刷新列表并更新今日饮水总量
   - 实现文件：`pages/water/index.vue`

2. **历史记录功能**：
   - 添加"查看历史"按钮（今日记录区域右上角）
   - 新建历史记录页面：pages/water/history.vue
   - 页面功能：
     - 日期选择器（选择查看日期）
     - 该日期的所有喝水记录列表
     - 当日总饮水量统计
     - 支持删除历史记录
   - 或直接使用弹窗展示历史记录

3. **时间Bug修复**：
   - 检查recordTime字段的格式化和显示逻辑
   - 修复NaN:NaN显示问题
   - 确保正确显示时间（如 13:25）

**页面路径**：`pages/water/index.vue`

---

### 6. 首页健康概览饮水展示优化 🟡 中优先级
**状态**：开发中  
**负责人**：home-water-display  
**预计工期**：半天  

**用户需求**：
1. 首页"健康概览"区域，饮水单位改为显示"多少毫升"
2. 实时展示饮水今日用量

**详细需求**：

1. **单位修改**：
   - 将饮水单位改为"ml"或"毫升"
   - 显示格式：今日已饮水量 / 目标量（如：1500ml / 2000ml）

2. **实时展示**：
   - 从后端API获取今日饮水数据
   - 页面显示时刷新数据（onShow钩子）
   - 数据实时更新

3. **样式优化**：
   - 确保显示清晰、醒目
   - 与整体风格保持一致

**页面路径**：`pages/home/index.vue`

---

### 7. 首页底部任务栏（tabBar）不显示 🔥 **最高优先级**
**状态**：开发中  
**负责人**：fix-tabbar-urgent  
**预计工期**：半天  

**用户反馈**：首页底部任务栏仍然没有展示，多次修复未生效！

**排查清单（必须逐项完成）**：

| 序号 | 检查项 | 状态 |
|------|--------|------|
| 1 | pages.json tabBar配置 | [ ] |
| 2 | 页面注册情况 | [ ] |
| 3 | 图标文件存在性 | [ ] |
| 4 | App.vue全局样式 | [ ] |
| 5 | 首页样式遮挡 | [ ] |
| 6 | manifest.json配置 | [ ] |
| 7 | 运行环境检查 | [ ] |
| 8 | 终极排查（最小化测试） | [ ] |

**修复要求**：
1. 逐项排查，每完成一项打勾
2. 找出根本原因
3. 提供完整的修复方案
4. 验证修复后 tabBar 能正常显示

**优先级**：🔥 **最高优先级，必须优先解决！**

---

### 8. 首页今日待办事项不展示 🔴 高优先级
**状态**：开发中  
**负责人**：fix-today-todo-final  
**预计工期**：半天  

**用户反馈**：首页"今日待办"区域仍然没有展示内容。

**排查方向**：

| 检查项 | 可能原因 | 解决方案 |
|--------|---------|----------|
| API调用 | 未正确调用/api/task/today/{familyId} | 检查API调用和token |
| 数据处理 | 返回数据未正确赋值给todayTasks | 添加数据转换和错误处理 |
| 渲染逻辑 | v-if/v-for条件判断问题 | 检查模板渲染逻辑 |
| onShow钩子 | 页面显示时未刷新数据 | 确保onShow正确触发 |
| 家庭ID | currentFamily为null或无效 | 添加默认值和空值处理 |

**修复要求**：
1. 添加详细的console.log调试信息
2. 完善错误处理逻辑
3. 确保空状态和正常状态都能正确显示
4. 修复后验证今日待办能正常展示

**页面路径**：`pages/home/index.vue`

---

### 8. 首页待办创建改为弹出式窗口 🟡 中优先级
**状态**：开发中  
**负责人**：home-todo-popup  
**预计工期**：半天  

**用户需求**：
1. 首页"今日待办"区域的创建任务改为弹出式窗口（弹窗）
2. 日期虽然可选择，但默认今天

**详细需求**：

1. **创建弹窗**：
   - 点击"+ 添加任务"按钮弹出创建窗口
   - 不跳转到新页面，在当前页弹窗创建
   - 弹窗样式美观，与App风格一致

2. **表单内容**：
   - 任务标题输入框
   - 日期选择器（默认今天，可选其他日期）
   - 优先级选择（普通/重要/紧急）
   - 确认/取消按钮

3. **交互逻辑**：
   - 创建成功后刷新今日待办列表
   - 关闭弹窗后显示新创建的任务
   - 支持点击遮罩层或X按钮关闭弹窗

**页面路径**：`pages/home/index.vue`

---

### 9. 任务详情页面重新开发 🟡 中优先级
**状态**：开发中  
**负责人**：task-detail-redesign  
**预计工期**：半天  

**用户需求**：
1. 重新开发任务详情页面（样式布局要美观）
2. **去掉以下两个部分**：
   - ❌ 执行人区域（显示"创建于 2026-02-23T06:00:59"）
   - ❌ 子任务区域（显示"添加子任务..."）

**保留功能**：
- ✅ 任务标题
- ✅ 截止时间
- ✅ 优先级
- ✅ 提醒设置
- ✅ 标记完成按钮
- ✅ 删除任务按钮

**优化要求**：
- 重新设计页面布局，使其更美观
- 与App整体风格保持一致
- 简洁清晰，重点突出

**页面路径**：`pages/task/detail.vue`

---

### 10. 月度报告页面修改 🟡 中优先级
**状态**：开发中  
**负责人**：monthly-report-modify  
**预计工期**：半天  

**用户需求**：
1. 修改月度报告页面，去掉评分等功能
2. 保留健康和心愿墙相关功能
3. 心愿墙不展示金额

**需要去掉的功能**：
- ❌ 综合评分（85分）
- ❌ 超越家庭（68%）
- ❌ 环比增长（12%）
- ❌ "优秀"标签
- ❌ "本月表现很棒，继续保持！"评语

**保留功能**：
- ✅ 健康和心愿墙相关功能

**心愿墙修改**：
- 心愿墙列表不显示金额字段

**优化要求**：
- 重新调整页面布局
- 简洁清晰，重点突出健康和心愿墙

**页面路径**：查找 `pages/report/monthly.vue` 或 `pages/dashboard/monthly.vue` 或类似

---

### 11. 隐藏财务报表功能 🟢 低优先级
**状态**：开发中  
**负责人**：hide-financial-report  
**预计工期**：1小时  

**用户需求**：隐藏财务报表功能

**执行内容**：
1. 找到财务报表功能的入口（可能在首页、我的页面等）
2. 隐藏或移除财务报表功能的入口按钮/链接
3. 检查位置：
   - 首页快捷功能图标
   - "我的"页面功能列表
   - 其他可能入口

**处理方式**：
- 隐藏入口（保留页面但不展示入口）
- 或完全移除相关代码

---

### 12. 年度报告页面修改 🟡 中优先级
**状态**：开发中  
**负责人**：annual-report-modify  
**预计工期**：半天  

**用户需求**：
1. 修改年度报告页面
2. **去掉评分功能**
3. **保留其他所有功能**
4. **页面样式设置为小清新风格**

**执行内容**：
1. 找到年度报告页面
2. 移除评分相关模块
3. 保留其他所有功能模块
4. 修改页面样式为小清新风格：
   - 使用清新的配色（薄荷绿、淡粉色、天蓝色等）
   - 简洁的布局
   - 柔和的背景色
   - 圆角卡片设计

**页面路径**：查找 `pages/report/annual.vue` 或 `pages/dashboard/annual.vue` 或类似

---

### 13. 首页待办完成状态不保存 🔴 高优先级
**状态**：开发中  
**负责人**：fix-todo-complete-status  
**预计工期**：半天  

**用户反馈**：
首页"今日待办"列表中的任务复选框，点击后有特效，但是没有更新到后端数据库。

**问题描述**：
- 点击任务复选框显示完成特效（前端状态改变）
- 但完成状态没有保存到后端
- 刷新页面后任务显示为未完成

**排查方向**：

| 检查项 | 可能原因 | 解决方案 |
|--------|---------|----------|
| API调用 | 未调用更新任务状态API | 添加toggleTaskStatus API调用 |
| 参数传递 | taskId或status参数错误 | 检查参数正确性 |
| 后端接口 | 后端状态更新接口异常 | 检查后端日志 |
| 错误处理 | 前端未处理API错误 | 添加错误提示 |

**修复要求**：
1. 点击复选框后调用后端API保存完成状态
2. API成功后才更新前端显示
3. 失败时提示用户并恢复状态
4. 刷新后能正确显示完成状态

**页面路径**：`pages/home/index.vue`

---

### 15. 心愿墙页面美化优化 🟡 中优先级
**状态**：开发中  
**负责人**：wish-wall-beautify  
**预计工期**：半天  

**用户反馈心愿墙需要优化**：

| 问题 | 说明 |
|------|------|
| ❌ **去掉金额** | 添加心愿弹窗中的"预算金额"字段需要去掉 |
| 🎨 **样式圆润** | 按钮、卡片、输入框等改为圆角设计 |
| 🎁 **图标优化** | 心愿类型图标换更好看的 |
| 🌸 **温馨小清新** | 整体配色改为温馨小清新风格 |
| ✏️ **字体调整** | 调整字体大小、颜色、粗细 |
| 🔧 **修复加载** | 修复"加载失败"错误 |

**优化要求**：
1. 去掉预算金额输入框
2. 所有元素圆角设计（按钮、卡片、输入框）
3. 更换7种心愿类型的图标（物品、体验、目标、学习、关系、公益、其他）
4. 温馨小清新配色（柔和的粉色、米色等）
5. 字体排版优化
6. 修复数据加载问题

**页面路径**：`pages/wish/index.vue`

---

### 14. 首页添加待办按钮修复 + 弹窗添加时分秒选择 ✅
**状态**：已完成  
**负责人**：fix-todo-button-time  
**完成时间**：2026-02-23 14:15  

**用户反馈两个问题**：

**问题1：添加待办按钮没了** 🔴
- 首页"今日待办"区域的"+ 添加任务"按钮消失了
- 需要找回或重新添加这个按钮

**问题2：弹窗添加时分秒选择** 🟡
- 添加待办弹窗目前只选择日期
- 需要添加时分秒选择（或至少时分）
- 默认时间可设置为当天23:59或当前时间

**修复内容**：
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 添加任务按钮 | ✅ | 在今日待办section-header添加"+ 添加任务"按钮（渐变绿色样式）|
| 按钮点击事件 | ✅ | 点击按钮调用openCreateModal()打开弹窗 |
| 日期选择器 | ✅ | 保留原有日期选择功能，默认当天 |
| 时间选择器 | ✅ | 新增time picker，默认23:59 |
| 样式布局 | ✅ | 日期和时间并排显示，清晰美观 |
| 数据传递 | ✅ | 将选择的日期和时间传递给后端API |

**修改文件**：
- `src/pages/home/index.vue` - 添加"+ 添加任务"按钮及样式
- `src/components/task/TodoCreateModal.vue` - 添加时间选择器

**技术实现**：
- 使用uni-app picker组件，mode="time"实现时间选择
- 日期和时间并排布局，使用flex布局
- 默认时间设置为23:59
- 将日期和时间组合成ISO 8601格式传递给后端

---

### 心愿墙页面重新布局开发 ✅
**状态**：已完成  
**负责人**：wish-wall-redesign  
**完成时间**：2026-02-23  

**需求描述**：
1. 重新布局开发心愿墙页面
2. 添加功能修复：点击"+"按钮应弹出添加心愿弹窗
3. 添加完心愿后要在页面上展示出来

**完成内容**：
| 功能 | 状态 | 说明 |
|------|------|------|
| 页面布局重新设计 | ✅ | 顶部渐变背景+统计卡片，现代化设计风格 |
| 心愿卡片展示 | ✅ | 精美卡片设计，包含类型标签、状态、进度条等 |
| 分类筛选 | ✅ | 全部/我的心愿/已认领/已实现，带计数显示 |
| 添加心愿弹窗 | ✅ | 完整表单：标题、描述、类型、优先级、日期、预算 |
| 心愿详情弹窗 | ✅ | 点击卡片查看详情，支持认领/编辑/删除操作 |
| 认领功能 | ✅ | 点击认领按钮，显示认领人头像 |
| 进度展示 | ✅ | 心愿进度条可视化展示 |
| 数据加载 | ✅ | 页面加载自动获取，下拉刷新，上拉加载更多 |
| 空状态处理 | ✅ | 无数据时显示友好空状态提示 |

**页面路径**：`pages/wish/index.vue`

**设计亮点**：
- 顶部渐变色头部背景，展示心愿统计（全部/我的/已认领/已实现）
- 心愿卡片左侧彩色边框区分状态（我的心愿/已认领/已实现）
- 卡片包含类型标签、优先级、期望日期等元信息
- 添加弹窗支持7种心愿类型选择（物品/体验/目标/学习/关系/公益/其他）
- 详情弹窗展示完整信息，支持进度更新操作
- 整体采用圆角卡片+柔和阴影设计，现代简洁风格

---

### 16. 数据看板页面实时查询开发（前后端） 🔴 高优先级
**状态**：开发中  
**负责人**：dashboard-realtime-dev  
**预计工期**：1-2天  

**用户需求**：数据看板页面需要实时查询，前后端都要开发！

**页面模块**：

| 模块 | 内容 | 数据来源 |
|------|------|----------|
| **今日概览** | 待办任务数、今日摄入(kcal)、本周完成、家庭成员 | 实时计算 |
| **本周热量趋势** | 本周每天热量摄入、平均值 | 饮食记录 |
| **任务统计** | 任务完成情况统计 | 任务数据 |

**开发要求**：

1. **前端开发**：
   - 页面布局（pages/dashboard/index.vue）
   - 调用后端API获取实时数据
   - 数据可视化展示（图表）

2. **后端开发**：
   - 开发数据查询聚合接口
   - 从多个服务获取数据（task-service、health-service、family-service）
   - 实时计算统计数据

3. **实时性**：
   - 页面加载时获取最新数据
   - 支持下拉刷新

**页面路径**：`pages/dashboard/index.vue` 或类似

**后端接口**：需要新开发数据聚合接口

---

## 📅 开发计划

```
本周计划（2月23日-2月28日）：
├── 周一：首页AI入口 + tabBar问题修复
├── 周二：记录饮食页面重新开发
├── 周三：AI购物助手功能页
└── 周四-周五：联调测试 + bug修复
```

---

## 📝 变更记录

| 时间 | 变更内容 | 变更人 |
|------|----------|--------|
| 2026-02-23 12:42 | 完成记录饮食页面重新开发 | diet-record-redev |
| 2026-02-23 12:42 | 移除首页错误AI输入区域 | diet-record-redev |
| 2026-02-23 12:15 | AI购物助手改为首页入口 | main |
| 2026-02-23 12:00 | 创建开发文档 | main |
| 2026-02-23 12:00 | 创建开发文档 | main |
| 2026-02-23 12:15 | 添加记录饮食开发任务 | main |
| 2026-02-23 12:15 | AI购物助手改为首页入口 | main |

---

### 20. 心愿墙添加心愿弹窗优化 🔴 高优先级
**状态**：开发中  
**负责人**：wish-popup-redesign  
**预计工期**：半天  

**用户反馈**：
1. 页面设计不够温馨圆润
2. 图标需要更换更好看的
3. 时间选择要精确到10分钟
4. 现在点击后前端没有显示

**开发要求**：

1. **重新设计弹窗样式**：
   - 更温馨圆润的风格
   - 柔和的配色
   - 圆角设计

2. **更换图标**：
   - 7种心愿类型更换更好看的emoji图标

3. **时间选择精确到10分钟**：
   - 期望实现时间增加时分选择
   - 分钟选择间隔为10分钟（00, 10, 20, 30, 40, 50）

4. **修复前端显示问题**：
   - 点击添加后正确显示在页面上
   - 前后端数据同步

**页面路径**：`pages/wish/index.vue` 弹窗组件

**后端**：需要支持时间精确到分钟的存储

---
