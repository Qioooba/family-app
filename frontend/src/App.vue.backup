<template>
  <view class="app-container">
    <router-view />
    <!-- 全局TabBar -->
    <up-tabbar
      v-model="current"
      :list="tabList"
      active-color="#6B8DD6"
      inactive-color="#8b9aad"
      bg-color="#ffffff"
      border-top
      :z-index="100"
      @change="onTabChange"
    />
  </view>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useUserStore } from './stores/user'
import { initTheme } from './utils/theme.js'

const userStore = useUserStore()
const current = ref(0)

// 初始化主题
onMounted(() => {
  initTheme()
})

const tabList = [
  {
    iconPath: 'home',
    selectedIconPath: 'home-fill',
    text: '首页',
    pagePath: '/pages/home/index'
  },
  {
    iconPath: 'calendar',
    selectedIconPath: 'calendar-fill',
    text: '任务',
    pagePath: '/pages/task/index'
  },
  {
    iconPath: 'heart',
    selectedIconPath: 'heart-fill',
    text: '心愿',
    pagePath: '/pages/wish/index'
  },
  {
    iconPath: 'account',
    selectedIconPath: 'account-fill',
    text: '我的',
    pagePath: '/pages/profile/index'
  }
]

onMounted(() => {
  // 检查登录状态（排除白名单页面）
  const whiteList = ['/pages/login/index', '/pages/register/index']
  const currentPage = getCurrentPages()[0]
  const currentRoute = currentPage ? currentPage.route : ''

  if (!whiteList.includes('/' + currentRoute)) {
    userStore.checkLogin()
  }
})

const onTabChange = (index) => {
  const page = tabList[index].pagePath
  uni.switchTab({ url: page })
}
</script>

<style lang="scss">
.app-container {
  min-height: 100vh;
  background: #f5f6fa;
}

/* TabBar 样式优化 */
.up-tabbar {
  box-shadow: 0 -8rpx 32rpx rgba(107, 141, 214, 0.08) !important;
  border-top: none !important;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2rpx;
    background: linear-gradient(90deg, transparent, rgba(107, 141, 214, 0.1), transparent);
  }
}

.up-tabbar-item {
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
  
  &:active {
    transform: scale(0.92);
  }
  
  &__icon {
    transition: all 0.3s ease !important;
  }
  
  &__text {
    font-weight: 500 !important;
    font-size: 22rpx !important;
  }
  
  &--active {
    .up-tabbar-item__icon {
      transform: scale(1.1);
    }
  }
}
</style>
