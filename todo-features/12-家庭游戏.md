# 🎮 家庭游戏功能 - 待开发

## 功能概述
增加家庭互动趣味性，通过游戏化机制增强家庭成员参与度。

## 功能清单

### 1. 抽奖转盘

#### 1.1 基础功能
- [ ] 自定义转盘奖项
  - 奖项名称
  - 奖项概率
  - 奖项颜色
  - 奖项图标
  
- [ ] 转盘模板
  - 家务分配转盘（谁洗碗/谁拖地/谁倒垃圾）
  - 惩罚游戏转盘
  - 奖励转盘
  - 今天吃什么转盘
  - 周末去哪玩转盘
  - 自定义转盘

#### 1.2 公平机制
- [ ] 历史记录查看
- [ ] 概率统计
- [ ] 公平性算法（避免连续同一人中奖）
- [ ] 强制轮空设置

#### 1.3 动画效果
- [ ] 转盘旋转动画
- [ ] 中奖特效（彩带/音效）
- [ ] 结果弹窗
- [ ] 分享结果图片

### 2. 积分系统

#### 2.1 积分获取
- [ ] 完成任务获得积分
- [ ] 实现心愿获得积分
- [ ] 连续打卡奖励
- [ ] 特殊活动奖励
- [ ] 家庭成员互赠积分

#### 2.2 积分规则
```yaml
积分规则:
  完成任务:
    普通任务: 10分
    重要任务: 20分
    紧急任务: 30分
  实现心愿:
    小愿望: 50分
    中愿望: 100分
    大愿望: 200分
  连续打卡:
    7天: 50分
    30天: 200分
    100天: 500分
  其他:
    每日登录: 5分
    分享动态: 10分
    获得点赞: 2分
```

#### 2.3 积分消费
- [ ] 兑换虚拟物品（头像框/主题）
- [ ] 兑换特权（免做家务券）
- [ ] 兑换实物奖励（由家主设置）
- [ ] 积分抽奖
- [ ] 积分转账

### 3. 排行榜

#### 3.1 排行榜类型
- [ ] 周排行榜
- [ ] 月排行榜
- [ ] 年排行榜
- [ ] 总排行榜

#### 3.2 排行维度
- [ ] 积分排行
- [ ] 任务完成数排行
- [ ] 心愿实现数排行
- [ ] 菜谱做过数排行
- [ ] 活跃度排行

#### 3.3 排行展示
- [ ] Top 3特殊展示（金银铜）
- [ ] 上升/下降箭头
- [ ] 与上一名差距
- [ ] 个人排名高亮

### 4. 成就徽章

#### 4.1 成就体系
- [ ] 任务类成就
  - 初次完成者
  - 任务达人（完成100个任务）
  - 准时达人（连续7天按时完成任务）
  
- [ ] 心愿类成就
  - 梦想家（发布10个心愿）
  - 实现者（实现5个心愿）
  - 心愿守护者（帮助他人实现3个心愿）
  
- [ ] 菜谱类成就
  - 小厨师（做过10道菜）
  - 大厨（做过50道菜）
  - 美食家（收藏100个菜谱）
  
- [ ] 健康类成就
  - 健康达人（连续30天记录饮食）
  - 减肥成功（减重5kg）
  - 运动健将（连续7天运动打卡）
  
- [ ] 社交类成就
  - 活跃分子（发布50条动态）
  - 人气王（获得100个赞）
  - 评论员（发表50条评论）
  
- [ ] 特殊成就
  - 早起鸟（连续7天6点前起床）
  - 夜猫子（连续7天23点后睡觉）
  - 完美家庭（所有成员连续7天完成任务）

#### 4.2 徽章展示
- [ ] 徽章墙展示
- [ ] 徽章详情弹窗
- [ ] 解锁动画
- [ ] 分享徽章
- [ ] 徽章 rarity（普通/稀有/史诗/传说）

#### 4.3 徽章收集
- [ ] 收集进度
- [ ] 系列徽章（收集一套额外奖励）
- [ ] 隐藏徽章（达成特殊条件解锁）

### 5. 家庭挑战

#### 5.1 挑战类型
- [ ] 7天健康饮食挑战
- [ ] 30天运动打卡挑战
- [ ] 全家早起挑战
- [ ] 零外卖挑战
- [ ] 省钱挑战
- [ ] 自定义挑战

#### 5.2 挑战机制
- [ ] 创建挑战
- [ ] 邀请家庭成员参加
- [ ] 每日打卡
- [ ] 进度追踪
- [ ] 挑战奖励
- [ ] 挑战排行榜

### 6. 技术实现

#### 6.1 后端API设计
```java
// 转盘相关
POST /api/game/wheel/create    // 创建转盘
GET /api/game/wheel/{familyId}  // 获取转盘列表
POST /api/game/wheel/{id}/spin  // 转动转盘

// 积分相关
GET /api/game/points/{userId}           // 获取积分
GET /api/game/points/history/{userId}   // 积分历史
POST /api/game/points/exchange          // 积分兑换
POST /api/game/points/transfer          // 积分转账

// 排行榜
GET /api/game/rankings/{familyId}?type=weekly&dimension=points

// 成就相关
GET /api/game/achievements/{userId}     // 获取成就列表
GET /api/game/achievements/unlock/{id}  // 解锁成就

// 挑战相关
POST /api/game/challenge/create
GET /api/game/challenge/{familyId}
POST /api/game/challenge/{id}/join
POST /api/game/challenge/{id}/checkin
```

#### 6.2 前端页面
```
frontend/src/pages/game/
├── index.vue           # 游戏首页
├── wheel/
│   ├── index.vue       # 转盘列表
│   ├── create.vue      # 创建转盘
│   └── play.vue        # 玩转盘
├── points/
│   ├── index.vue       # 积分页面
│   ├── history.vue     # 积分历史
│   └── exchange.vue    # 积分兑换
├── rankings.vue        # 排行榜
├── achievements.vue    # 成就徽章
└── challenge/
    ├── index.vue       # 挑战列表
    ├── create.vue      # 创建挑战
    └── detail.vue      # 挑战详情
```

#### 6.3 转盘动画组件
```vue
<template>
  <view class="wheel-container">
    <canvas canvas-id="wheelCanvas" class="wheel-canvas"></canvas>
    <view class="wheel-pointer" @click="spin">开始</view>
  </view>
</template>

<script>
export default {
  methods: {
    spin() {
      // 旋转动画
      const duration = 5000 // 5秒
      const rotations = 5 + Math.random() * 5 // 5-10圈
      // 计算中奖结果
      // 播放音效
      // 显示结果
    }
  }
}
</script>
```

### 7. 数据库表
```sql
-- 转盘表
CREATE TABLE game_wheel (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    family_id BIGINT NOT NULL,
    name VARCHAR(100) NOT NULL,
    items JSON NOT NULL COMMENT '转盘项 [{name, probability, color, icon}]',
    creator_id BIGINT,
    use_count INT DEFAULT 0,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 转盘历史记录
CREATE TABLE game_wheel_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    wheel_id BIGINT NOT NULL,
    family_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    result VARCHAR(100) COMMENT '中奖结果',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 积分表
CREATE TABLE user_points (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL UNIQUE,
    total_points INT DEFAULT 0 COMMENT '总积分',
    available_points INT DEFAULT 0 COMMENT '可用积分',
    spent_points INT DEFAULT 0 COMMENT '已消费积分',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 积分流水
CREATE TABLE points_transaction (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    type ENUM('earn', 'spend', 'transfer_in', 'transfer_out') NOT NULL,
    points INT NOT NULL,
    balance INT NOT NULL COMMENT '变动后余额',
    reason VARCHAR(200) COMMENT '变动原因',
    related_id BIGINT COMMENT '关联业务ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_time (user_id, create_time)
);

-- 成就定义表
CREATE TABLE achievement_def (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(50) NOT NULL UNIQUE COMMENT '成就编码',
    name VARCHAR(100) NOT NULL,
    description TEXT,
    icon VARCHAR(255),
    rarity ENUM('common', 'rare', 'epic', 'legendary') DEFAULT 'common',
    condition_type VARCHAR(50) COMMENT '条件类型',
    condition_value INT COMMENT '条件值',
    points_reward INT DEFAULT 0 COMMENT '奖励积分',
    secret TINYINT DEFAULT 0 COMMENT '是否隐藏成就'
);

-- 用户成就表
CREATE TABLE user_achievement (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    achievement_id BIGINT NOT NULL,
    unlock_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_new TINYINT DEFAULT 1 COMMENT '是否新获得',
    UNIQUE KEY uk_user_achievement (user_id, achievement_id)
);

-- 挑战表
CREATE TABLE family_challenge (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    family_id BIGINT NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    type VARCHAR(50) COMMENT '挑战类型',
    target_value INT COMMENT '目标值',
    duration_days INT COMMENT '持续天数',
    reward_points INT COMMENT '奖励积分',
    reward_badge_id BIGINT COMMENT '奖励徽章',
    start_time DATETIME,
    end_time DATETIME,
    creator_id BIGINT,
    status TINYINT DEFAULT 0 COMMENT '0未开始 1进行中 2已结束',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 挑战参与记录
CREATE TABLE challenge_participant (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    challenge_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    current_value INT DEFAULT 0,
    is_completed TINYINT DEFAULT 0,
    complete_time DATETIME,
    UNIQUE KEY uk_challenge_user (challenge_id, user_id)
);

-- 挑战打卡记录
CREATE TABLE challenge_checkin (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    challenge_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    checkin_date DATE NOT NULL,
    value INT COMMENT '当日数值',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_challenge_user_date (challenge_id, user_id, checkin_date)
);
```

## 开发优先级
1. P2 - 抽奖转盘
2. P2 - 积分系统
3. P3 - 排行榜
4. P3 - 成就徽章
5. P3 - 家庭挑战

## 预估开发时间
- 后端API开发：4天
- 前端页面开发：5天
- 动画效果开发：2天
- 联调测试：2天
- **总计：约13天**
