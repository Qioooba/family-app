# 📊 数据看板功能 - 待开发（完整版）

## 功能概述
全面的数据统计和分析看板，帮助家庭了解各项数据趋势。

## 当前状态
- ⚠️ 首页已有基础统计（任务数/心愿数/菜谱数/卡路里）
- ❌ 缺少详细的可视化报表和趋势分析

## 功能清单

### 1. 个人看板

#### 1.1 今日概览
- [x] 今日待办（已完成）
- [x] 今日饮食摄入（已完成）
- [x] 今日纪念日（已完成）
- [ ] 今日天气（待添加）
- [ ] 今日步数/运动（待添加）

#### 1.2 本周回顾
- [ ] 任务完成率趋势图
- [ ] 饮食摄入周报表
- [ ] 体重变化曲线
- [ ] 睡眠质量统计
- [ ] 心情记录统计

#### 1.3 月度报告
- [ ] 月度任务统计
  - 完成任务数
  - 按时完成率
  - 任务类型分布饼图
  - 家庭贡献排行
  
- [ ] 月度饮食报告
  - 总热量摄入
  - 营养素摄入分析（蛋白质/碳水/脂肪占比）
  - 饮食习惯评分
  - 健康建议
  
- [ ] 月度心愿统计
  - 新增心愿数
  - 实现心愿数
  - 心愿类型分布
  
- [ ] 月度菜谱统计
  - 做过的菜
  - 收藏的菜
  - 最爱食材

### 2. 家庭看板

#### 2.1 家庭动态
- [ ] 最近发生的事时间轴
- [ ] 家庭成员活跃度
- [ ] 今日家庭日程

#### 2.2 成员状态
- [ ] 每个成员的任务完成情况
- [ ] 每个成员的饮食记录
- [ ] 成员健康数据对比
- [ ] 成员积分排行

#### 2.3 共同目标进度
- [ ] 储蓄目标进度
- [ ] 健康目标进度
- [ ] 学习目标进度
- [ ] 目标完成预测

### 3. 专项报表

#### 3.1 任务报表
- [ ] 任务完成趋势图（折线图）
- [ ] 任务类型分布（饼图）
- [ ] 任务优先级分布（柱状图）
- [ ] 成员任务完成对比（雷达图）
- [ ] 逾期任务统计

#### 3.2 饮食报表
- [ ] 热量摄入趋势（周/月）
- [ ] 营养素摄入分析（堆叠柱状图）
- [ ] 饮食时间分布（热力图）
- [ ] 最爱食物排行
- [ ] 健康饮食评分趋势

#### 3.3 财务报表
- [ ] 月度收支统计
- [ ] 支出分类占比（饼图）
- [ ] 支出趋势（折线图）
- [ ] 预算执行情况
- [ ] 储蓄进度追踪

#### 3.4 心愿报表
- [ ] 心愿实现率
- [ ] 心愿类型分布
- [ ] 心愿实现时间统计
- [ ] 家庭目标完成度

### 4. 年度回忆

#### 4.1 年度总结
- [ ] 年度关键词
- [ ] 年度大事记
- [ ] 年度成就徽章

#### 4.2 数据可视化
- [ ] 年度任务完成数
- [ ] 年度饮食记录数
- [ ] 年度心愿实现数
- [ ] 年度家庭活动数

#### 4.3 照片墙
- [ ] 年度照片精选
- [ ] 按月份展示
- [ ] 自动生成回忆视频

### 5. 技术实现

#### 5.1 后端API设计
```java
// 个人统计
GET /api/stats/personal/{userId}?type=daily&date=2025-02-21
GET /api/stats/personal/{userId}?type=weekly
GET /api/stats/personal/{userId}?type=monthly

// 家庭统计
GET /api/stats/family/{familyId}?type=daily
GET /api/stats/family/{familyId}?type=weekly
GET /api/stats/family/{familyId}?type=monthly

// 任务统计
GET /api/stats/tasks/{familyId}?startDate=xxx&endDate=xxx
Response: {
  "totalTasks": 100,
  "completedTasks": 80,
  "completionRate": 0.8,
  "byCategory": [
    {"category": "购物", "count": 30},
    {"category": "家务", "count": 50}
  ],
  "byMember": [
    {"memberId": 1, "name": "爸爸", "completed": 30},
    {"memberId": 2, "name": "妈妈", "completed": 50}
  ],
  "trend": [
    {"date": "2025-02-01", "completed": 5},
    {"date": "2025-02-02", "completed": 3}
  ]
}

// 饮食统计
GET /api/stats/diet/{userId}?type=weekly
Response: {
  "totalCalories": 15000,
  "avgDailyCalories": 2143,
  "proteinAvg": 65,
  "carbsAvg": 200,
  "fatAvg": 70,
  "mealDistribution": {
    "breakfast": 0.3,
    "lunch": 0.4,
    "dinner": 0.3
  }
}

// 年度回忆
GET /api/stats/yearly/{familyId}?year=2025
```

#### 5.2 前端页面
```
frontend/src/pages/dashboard/
├── index.vue           # 看板首页
├── personal.vue        # 个人统计
├── family.vue          # 家庭统计
├── tasks.vue           # 任务报表
├── diet.vue            # 饮食报表
├── finance.vue         # 财务报表
├── wishes.vue          # 心愿报表
└── yearly.vue          # 年度回忆
```

#### 5.3 图表库
```javascript
// 使用ECharts
import * as echarts from 'echarts'

// 需要实现的图表类型
- 折线图（趋势）
- 柱状图（对比）
- 饼图（占比）
- 雷达图（多维对比）
- 热力图（时间分布）
- 漏斗图（转化）
```

### 6. 数据库表
```sql
-- 统计数据缓存表（提高查询性能）
CREATE TABLE stats_cache (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    stat_type VARCHAR(50) NOT NULL COMMENT '统计类型',
    target_id BIGINT NOT NULL COMMENT '用户ID或家庭ID',
    stat_date DATE NOT NULL,
    data JSON COMMENT '统计结果JSON',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_type_target_date (stat_type, target_id, stat_date)
);

-- 用户活跃度表
CREATE TABLE user_activity (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    date DATE NOT NULL,
    login_count INT DEFAULT 0,
    task_completed INT DEFAULT 0,
    diet_recorded INT DEFAULT 0,
    active_minutes INT DEFAULT 0,
    UNIQUE KEY uk_user_date (user_id, date)
);
```

## 开发优先级
1. P1 - 任务统计报表
2. P1 - 饮食统计报表
3. P2 - 财务统计报表
4. P2 - 家庭看板
5. P3 - 年度回忆

## 预估开发时间
- 后端统计API：3天
- 数据聚合计算：2天
- 前端图表开发：4天
- 联调优化：2天
- **总计：约11天**
