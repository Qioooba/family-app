# ğŸ’¬ å®¶åº­åœˆåŠŸèƒ½ - å¾…å¼€å‘

## åŠŸèƒ½æ¦‚è¿°
å®¶åº­å†…éƒ¨çš„ç¤¾äº¤åœˆï¼Œç±»ä¼¼æœ‹å‹åœˆï¼Œå®¶åº­æˆå‘˜å¯ä»¥å‘å¸ƒåŠ¨æ€ã€äº’åŠ¨ã€‚

## åŠŸèƒ½æ¸…å•

### 1. åŠ¨æ€å‘å¸ƒ

#### 1.1 å†…å®¹å½¢å¼
- [ ] æ–‡å­—åŠ¨æ€
- [ ] å›¾ç‰‡åŠ¨æ€ï¼ˆå•å¼ /å¤šå¼ ï¼‰
- [ ] è§†é¢‘åŠ¨æ€
- [ ] è¯­éŸ³åŠ¨æ€
- [ ] æ··åˆå†…å®¹

#### 1.2 å‘å¸ƒåœºæ™¯
- [ ] åˆ†äº«ç¾é£Ÿç…§ç‰‡
- [ ] è®°å½•å®¶åº­æ´»åŠ¨
- [ ] å­©å­æˆé•¿è®°å½•
- [ ] æ—…è¡Œåˆ†äº«
- [ ] æ—¥å¸¸ç”Ÿæ´»ç‚¹æ»´

#### 1.3 å‘å¸ƒåŠŸèƒ½
- [ ] @æåŠå®¶åº­æˆå‘˜
- [ ] æ·»åŠ è¯é¢˜æ ‡ç­¾ #æ™šé¤ #å‘¨æœ«å‡ºè¡Œ
- [ ] ä½ç½®å®šä½
- [ ] éšç§è®¾ç½®ï¼ˆå…¬å¼€/ä»…å®¶åº­ï¼‰
- [ ] å®šæ—¶å‘å¸ƒ

### 2. åŠ¨æ€æµ

#### 2.1 æ—¶é—´çº¿å±•ç¤º
- [ ] æŒ‰æ—¶é—´å€’åºæ’åˆ—
- [ ] ç€‘å¸ƒæµå¸ƒå±€
- [ ] ä¸‹æ‹‰åˆ·æ–°
- [ ] ä¸Šæ‹‰åŠ è½½æ›´å¤š
- [ ] å›¾ç‰‡æ‡’åŠ è½½

#### 2.2 å†…å®¹å±•ç¤º
- [ ] å‘å¸ƒè€…å¤´åƒå’Œæ˜µç§°
- [ ] å‘å¸ƒæ—¶é—´
- [ ] æ–‡å­—å†…å®¹
- [ ] å›¾ç‰‡/è§†é¢‘é¢„è§ˆ
- [ ] ç‚¹èµæ•°/è¯„è®ºæ•°

#### 2.3 ç­›é€‰åŠŸèƒ½
- [ ] æŒ‰æˆå‘˜ç­›é€‰
- [ ] æŒ‰æ ‡ç­¾ç­›é€‰
- [ ] æŒ‰æ—¶é—´ç­›é€‰
- [ ] æœç´¢åŠ¨æ€

### 3. äº’åŠ¨åŠŸèƒ½

#### 3.1 ç‚¹èµ
- [ ] å•æ¡åŠ¨æ€ç‚¹èµ
- [ ] ç‚¹èµåˆ—è¡¨æŸ¥çœ‹
- [ ] ç‚¹èµé€šçŸ¥
- [ ] å–æ¶ˆç‚¹èµ

#### 3.2 è¯„è®º
- [ ] å‘è¡¨è¯„è®º
- [ ] å›å¤è¯„è®º
- [ ] åˆ é™¤è‡ªå·±çš„è¯„è®º
- [ ] è¯„è®º@æåŠ
- [ ] è¯„è®ºå›¾ç‰‡/è¡¨æƒ…

#### 3.3 è¡¨æƒ…ååº”
- [ ] ğŸ‘ ç‚¹èµ
- [ ] â¤ï¸ çˆ±å¿ƒ
- [ ] ğŸ˜‚ ç¬‘å“­
- [ ] ğŸ‰ åº†ç¥
- [ ] ğŸ¤” æ€è€ƒ

#### 3.4 åˆ†äº«
- [ ] åˆ†äº«åˆ°å¾®ä¿¡
- [ ] ç”Ÿæˆåˆ†äº«å›¾ç‰‡
- [ ] å¤åˆ¶é“¾æ¥

### 4. é€šçŸ¥ä¸­å¿ƒ

#### 4.1 æ¶ˆæ¯ç±»å‹
- [ ] è¢«@æé†’
- [ ] æ–°è¯„è®ºæé†’
- [ ] æ–°ç‚¹èµæé†’
- [ ] å®¶åº­å…¬å‘Š

#### 4.2 æ¨é€è®¾ç½®
- [ ] æ¶ˆæ¯å…æ‰“æ‰°
- [ ] å…æ‰“æ‰°æ—¶æ®µ
- [ ] é€šçŸ¥æ–¹å¼ï¼ˆApp/çŸ­ä¿¡/å¾®ä¿¡ï¼‰

### 5. å®¶åº­å…¬å‘Š

#### 5.1 å…¬å‘Šå‘å¸ƒ
- [ ] å®¶ä¸»/ç®¡ç†å‘˜å‘å¸ƒå…¬å‘Š
- [ ] ç½®é¡¶å…¬å‘Š
- [ ] å…¬å‘Šæœ‰æ•ˆæœŸ
- [ ] å·²è¯»å›æ‰§

#### 5.2 å…¬å‘Šå±•ç¤º
- [ ] é¦–é¡µé¡¶éƒ¨å±•ç¤º
- [ ] å…¬å‘Šåˆ—è¡¨
- [ ] å†å²å…¬å‘Š

### 6. æŠ€æœ¯å®ç°

#### 6.1 åç«¯APIè®¾è®¡
```java
// å‘å¸ƒåŠ¨æ€
POST /api/moments/create
Request: {
  "familyId": 123,
  "userId": 456,
  "content": "ä»Šå¤©åšäº†çº¢çƒ§è‚‰",
  "images": ["url1", "url2"],
  "video": "url",
  "location": "å®¶é‡Œ",
  "tags": ["ç¾é£Ÿ", "æ™šé¤"],
  "mentions": [789, 101]
}
Response: {
  "id": 1001,
  "createTime": "2025-02-21 18:30:00"
}

// è·å–åŠ¨æ€æµ
GET /api/moments/feed/{familyId}?page=1&size=10
Response: {
  "total": 100,
  "list": [
    {
      "id": 1001,
      "user": {"id": 456, "nickname": "å¦ˆå¦ˆ", "avatar": "..."},
      "content": "ä»Šå¤©åšäº†çº¢çƒ§è‚‰",
      "images": ["url1", "url2"],
      "likeCount": 5,
      "commentCount": 3,
      "isLiked": true,
      "createTime": "2025-02-21 18:30:00"
    }
  ]
}

// ç‚¹èµ
POST /api/moments/{id}/like
DELETE /api/moments/{id}/like

// è¯„è®º
POST /api/moments/{id}/comment
Request: {
  "userId": 789,
  "content": "çœ‹èµ·æ¥å¥½å¥½åƒï¼",
  "replyTo": null
}

// åˆ é™¤åŠ¨æ€
DELETE /api/moments/{id}

// å‘å¸ƒå…¬å‘Š
POST /api/moments/announcement/create
GET /api/moments/announcement/{familyId}
```

#### 6.2 å‰ç«¯é¡µé¢
```
frontend/src/pages/moments/
â”œâ”€â”€ index.vue           # åŠ¨æ€æµé¦–é¡µ
â”œâ”€â”€ create.vue          # å‘å¸ƒåŠ¨æ€
â”œâ”€â”€ detail.vue          # åŠ¨æ€è¯¦æƒ…
â”œâ”€â”€ comments.vue        # è¯„è®ºåˆ—è¡¨
â”œâ”€â”€ notifications.vue   # é€šçŸ¥ä¸­å¿ƒ
â””â”€â”€ announcement.vue    # å…¬å‘Šé¡µé¢
```

#### 6.3 WebSocketå®æ—¶æ¨é€
```javascript
// è¿æ¥WebSocket
const socket = new WebSocket('ws://localhost:8080/ws/moments')

// ç›‘å¬æ–°æ¶ˆæ¯
socket.onmessage = (event) => {
  const data = JSON.parse(event.data)
  if (data.type === 'new_comment') {
    // æ˜¾ç¤ºæ–°è¯„è®ºé€šçŸ¥
  } else if (data.type === 'new_like') {
    // æ˜¾ç¤ºæ–°ç‚¹èµé€šçŸ¥
  }
}
```

### 7. æ•°æ®åº“è¡¨
```sql
-- åŠ¨æ€è¡¨
CREATE TABLE moment (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    family_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    content TEXT COMMENT 'æ–‡å­—å†…å®¹',
    images JSON COMMENT 'å›¾ç‰‡åˆ—è¡¨',
    video VARCHAR(255) COMMENT 'è§†é¢‘URL',
    location VARCHAR(200) COMMENT 'ä½ç½®',
    tags JSON COMMENT 'æ ‡ç­¾',
    mentions JSON COMMENT '@çš„ç”¨æˆ·IDåˆ—è¡¨',
    like_count INT DEFAULT 0,
    comment_count INT DEFAULT 0,
    is_top TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ç½®é¡¶',
    status TINYINT DEFAULT 1 COMMENT '0åˆ é™¤ 1æ­£å¸¸',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_family_time (family_id, create_time),
    INDEX idx_user (user_id)
);

-- ç‚¹èµè¡¨
CREATE TABLE moment_like (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    moment_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_moment_user (moment_id, user_id)
);

-- è¯„è®ºè¡¨
CREATE TABLE moment_comment (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    moment_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    content TEXT NOT NULL,
    reply_to BIGINT COMMENT 'å›å¤çš„è¯„è®ºID',
    reply_user_id BIGINT COMMENT 'å›å¤çš„ç”¨æˆ·ID',
    like_count INT DEFAULT 0,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_moment (moment_id),
    INDEX idx_user (user_id)
);

-- å…¬å‘Šè¡¨
CREATE TABLE family_announcement (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    family_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    publisher_id BIGINT NOT NULL,
    is_top TINYINT DEFAULT 0,
    expire_time DATETIME,
    read_count INT DEFAULT 0,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- å…¬å‘Šå·²è¯»è®°å½•
CREATE TABLE announcement_read (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    announcement_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    read_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_announcement_user (announcement_id, user_id)
);
```

## å¼€å‘ä¼˜å…ˆçº§
1. P1 - åŠ¨æ€å‘å¸ƒ/æŸ¥çœ‹
2. P1 - ç‚¹èµ/è¯„è®º
3. P2 - é€šçŸ¥ä¸­å¿ƒ
4. P2 - å®¶åº­å…¬å‘Š
5. P3 - WebSocketå®æ—¶æ¨é€

## é¢„ä¼°å¼€å‘æ—¶é—´
- åç«¯APIå¼€å‘ï¼š4å¤©
- WebSocketå®ç°ï¼š2å¤©
- å‰ç«¯é¡µé¢å¼€å‘ï¼š4å¤©
- è”è°ƒæµ‹è¯•ï¼š2å¤©
- **æ€»è®¡ï¼šçº¦12å¤©**
